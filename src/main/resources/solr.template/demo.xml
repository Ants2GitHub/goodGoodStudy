<?xml version="1.0" encoding="utf-8" ?>

<sotiy namespace="com.cxd.sotiy.test.Commodity">
    <select id="querySolrSpuWithSkuList">
        <field>name,id</field>
        <from>solrIndex</from>
        <where>
            <include>
            #if(${entityId} &amp;&amp; ${entityId} != '')
                entity_id:${entityId}
            #end
            #if(${valid})
                AND is_valid:1
            #end
            #if(${status} &amp;&amp; ${status} != '')
                AND status:${status}
            #end
            #if(${searchCode} &amp;&amp; ${searchCode} != '')
                AND (name:${searchCode} OR spell:*${searchCode}* OR tag:${searchCode} OR brand:${searchCode}
                #if(${barCodeSearch} &amp;&amp; ${barCodeSearch} != '')
                    OR ({!parent which="type:p"}sku_bar_code:*${searchCode}*)
            #end
            )
            #end
            </include>
            <include prefix=' AND _query_:"{!parent which=type:p}' suffix='"'>
                #if(${valid})
                    sku_is_valid:1
                #end
                #if(${standardInnerCode} &amp;&amp; ${standardInnerCode} != '')
                    AND sku_standard_inner_code:${standardInnerCode}
                #elseif(${categoryId} &amp;&amp; ${categoryId} == '0')
                    AND sku_standard_category_id:\"\"
                #end
                #if(${barCode} &amp;&amp; ${barCode} != '')
                    AND sku_bar_code:${barCode}
                #end
                <include>
                    #if(${adCodes} &amp;&amp; ${isVisibleOnly} != 1)
                        AND ((
                            <foreach expression="$temp in $!{adCodes}" trim="true" prefix="{!terms f=ad_codes}">
                                #if($velocityCount > 1),#end$temp
                            </foreach>
                            <include prefix=" #if(${sellerEntityIds})" suffix="#end" trim="true">
                                <foreach expression="$temp in $!{sellerEntityIds}" trim="true" prefix="AND -{!terms f=entity_id}">
                                    #if($velocityCount > 1),#end$temp
                                </foreach>
                            </include>
                            )
                            #if(${planNos}  &amp;&amp; ${planNos.size()} > 0 ) OR {!terms f=plan_nos}#foreach($temp in $!{planNos})#if($velocityCount > 1),#end$temp#end
                            #end)
                    #elseif(${isVisibleOnly} == 1)
                        AND #if(${planNos}  &amp;&amp; ${planNos.size()} > 0 ) {!terms f=plan_nos}#foreach($temp in $!{planNos})#if($velocityCount > 1),#end$temp#end#end
                    #end
                </include>
            </include>

        </where>
    </select>

</sotiy>